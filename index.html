<!DOCTYPE html>
<html lang="en">
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" />
<meta content="Asciidoctor 1.5.2" name="generator" />
<meta content="Cédric Champeau" name="author" />
<title>Convention over configuration: the Gradle way</title>
<link href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.1/css/font-awesome.min.css" rel="stylesheet" />
<style>
.conum { display: inline-block; color: white !important; background-color: #222222; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; width: 1.2em; height: 1.2em; font-size: 0.9em; font-weight: bold; line-height: 1.2; font-family: Arial, sans-serif; font-style: normal; position: relative; top: -0.1em; }
.conum * { color: white !important; }
.conum + b { display: none; }
.conum:after { content: attr(data-value); }
.conum:not([data-value]):empty { display: none; }
.colist table td:first-of-type { padding-right: 0.25em; }
</style>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{font-weight: normal}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#00}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
<link href="deck.js/core/deck.core.css" rel="stylesheet" />
<link href="deck.js/extensions/scale/deck.scale.css" media="screen" rel="stylesheet" />
<link href="deck.js/extensions/goto/deck.goto.css" media="screen" rel="stylesheet" />
<link href="deck.js/extensions/menu/deck.menu.css" media="screen" rel="stylesheet" />
<link href="deck.js/extensions/navigation/deck.navigation.css" media="screen" rel="stylesheet" />
<link href="deck.js/extensions/status/deck.status.css" media="screen" rel="stylesheet" />
<link href="deck.js/extensions/toc/deck.toc.css" media="screen" rel="stylesheet" />
<link href="deck.js/themes/style/web-2.0.css" media="screen" rel="stylesheet" />
<link href="deck.js/themes/transition/fade.css" media="screen" rel="stylesheet" />
<link href="deck.js/core/print.css" media="print" rel="stylesheet" />
<script src="deck.js/modernizr.custom.js"></script>
</head>
<body class="article">
<div class="deck-container">
<section class="slide" id="title-slide">
<h1>Convention over configuration: the Gradle way</h1>
<span id="author">Cédric Champeau</span>
<br />
<span id="email"><a href="http://twitter.com/CedricChampeau">@CedricChampeau</a></span>
<br />
<span id="revnumber">version 1.0,</span>
<span id="revdate">2015-05-05</span>
</section>
<section class="slide" id="who-am-i">
<h2>Who am I</h2>
<table class="tableblock frame-all grid-all" style="width:100%">
<colgroup>
<col style="width:80%" />
<col style="width:20%" />
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">speaker {
    name <span class="string"><span class="delimiter">'</span><span class="content">Cédric Champeau</span><span class="delimiter">'</span></span>
    company <span class="string"><span class="delimiter">'</span><span class="content">Gradle Inc</span><span class="delimiter">'</span></span>
    oss <span class="string"><span class="delimiter">'</span><span class="content">Apache Groovy committer</span><span class="delimiter">'</span></span>,
    successes ([<span class="string"><span class="delimiter">'</span><span class="content">Static type checker</span><span class="delimiter">'</span></span>,
                    <span class="string"><span class="delimiter">'</span><span class="content">Static compilation</span><span class="delimiter">'</span></span>,
                    <span class="string"><span class="delimiter">'</span><span class="content">Traits</span><span class="delimiter">'</span></span>,
                    <span class="string"><span class="delimiter">'</span><span class="content">Markup template engine</span><span class="delimiter">'</span></span>,
                    <span class="string"><span class="delimiter">'</span><span class="content">DSLs</span><span class="delimiter">'</span></span>])
        failures Stream.of(bugs),
        twitter <span class="string"><span class="delimiter">'</span><span class="content">@CedricChampeau</span><span class="delimiter">'</span></span>,
        github <span class="string"><span class="delimiter">'</span><span class="content">melix</span><span class="delimiter">'</span></span>,
        extraDescription <span class="string"><span class="delimiter">'''</span><span class="content">Groovy in Action 2 co-author
Misc OSS contribs (Gradle plugins, deck2pdf, jlangdetect, ...)</span><span class="delimiter">'''</span></span>
}</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="imageblock">
<div class="content">
<img alt="GradleLogoReg" src="./images/GradleLogoReg.png" />
</div>
</div>
<div class="imageblock">
<div class="content">
<img alt="groovy logo" src="./images/groovy-logo.png" />
</div>
</div></div></td>
</tr>
</tbody>
</table>
</section>
<section class="slide" id="gradle">
<h2>Gradle</h2>
<div class="ulist">
<ul>
<li>A dependency management engine</li>
<li>A dependency based execution system</li>
<li>A plugin system</li>
<li>A set of plugins</li>
</ul>
</div>
</section>
<section class="slide" id="gradle-2">
<h2>Gradle</h2>
<div class="ulist">
<ul>
<li>Open Source</li>
<li><p>
Language agnostic<div class="ulist">
<ul>
<li>builds Java, Groovy, Scala, C++, assembler, &#8230;&#8203;</li>
</ul>
</div></p></li>
<li>Designed for extensions</li>
<li>Integrates well with Ivy, Ant, Maven, &#8230;&#8203;</li>
</ul>
</div>
</section>
<section class="slide" id="about-this-slidedeck">
<h2>About this slidedeck</h2>
<div class="ulist">
<ul>
<li>Slides written using <a href="http://asciidoctor.org/">Asciidoctor</a></li>
<li>Converted to <a href="http://imakewebthings.com/deck.js/">deck.js</a></li>
<li>Exported to PDF thanks to <a href="https://github.com/melix/deck2pdf">deck2pdf</a></li>
<li>Integrated with <a href="http://gradle.org">Gradle</a></li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">repositories {
    jcenter()
}

apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">com.github.jruby-gradle.base</span><span class="delimiter">'</span></span>
apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">org.ysb33r.vfs</span><span class="delimiter">'</span></span>
apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>
apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">org.asciidoctor.convert</span><span class="delimiter">'</span></span>

dependencies {
    gems <span class="string"><span class="delimiter">'</span><span class="content">rubygems:haml:4.0.6</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</section>
<section class="slide" id="export-to-pdf">
<h2>Export to PDF</h2>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">configurations {
    pdf
}
repositories {
    mavenLocal()
}
dependencies {
    pdf <span class="string"><span class="delimiter">'</span><span class="content">com.github.melix:deck2pdf:0.2</span><span class="delimiter">'</span></span>
}

task generatePdf(<span class="key">type</span>:JavaExec) {
    dependsOn asciidoctor
    main = <span class="string"><span class="delimiter">'</span><span class="content">me.champeau.deck2pdf.Main</span><span class="delimiter">'</span></span>
    workingDir = file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/asciidoc/deckjs</span><span class="delimiter">&quot;</span></span>)
    args = [<span class="string"><span class="delimiter">'</span><span class="content">index.html</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">gradle-coc.pdf</span><span class="delimiter">'</span></span>]
    classpath = configurations.pdf

    inputs.file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>workingDir</span><span class="content">/index.html</span><span class="delimiter">&quot;</span></span>)
    outputs.file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>workingDir</span><span class="content">/gradle-coc.pdf</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</section>
<section class="slide" id="gradle-basics">
<h2>Gradle basics</h2>
<div class="ulist">
<ul>
<li>build scripts (often <em>build.gradle</em>)</li>
<li>a task execution graph</li>
<li>inline "plugins"</li>
<li>binary plugins</li>
<li>plugin portal</li>
<li>Gradle wrapper</li>
</ul>
</div>
</section>
<section class="slide" id="gradle-basics-2">
<h2>Gradle basics</h2>
<div class="quoteblock" id="gradle-quote">
<blockquote>
<div class="paragraph"><p>Make the impossible possible,<br />
make the possible easy<br />
and make the easy elegant</p></div>
<div class="attribution">
<cite>inspired by Moshe Feldenkrais</cite>
</div>
</blockquote>
</div>
</section>
<section class="slide" id="first-step-gradle-wrapper">
<h2>First step : Gradle wrapper</h2>
<div class="ulist">
<ul>
<li>Enforces a specific version of Gradle</li>
<li>Wrapper committed in VCS</li>
<li>Makes sure that the version of Gradle being used is the one the project is supposed to be compiled with</li>
<li>There&#8217;s no good reason not to use it</li>
</ul>
</div>
<div class="quoteblock" id="gradle-quote">
<blockquote>
<div class="paragraph"><p>Always use the wrapper. Always.</p></div>
<div class="attribution">
<cite>me</cite>
</div>
</blockquote>
</div>
</section>
<section class="slide" id="convention-over-configuration">
<h2>Convention over configuration</h2>
<div class="listingblock">
<div class="title">A simple Java project</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>

repositories {
    jcenter()
}

dependencies {
   testCompile <span class="string"><span class="delimiter">&quot;</span><span class="content">junit:junit:4.12</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</section>
<section class="slide" id="convention-over-configuration-2">
<h2>Convention over configuration</h2>
<div class="listingblock">
<div class="title">Before build</div>
<div class="content">
<pre><code>basic-java
├── build.gradle
└── src
    ├── main
    │   └── java
    │       └── com
    │           └── acme
    │               └── Greeter.java
    └── test
        └── java
            └── com
                └── acme
                    └── GreeterTest.java</code></pre>
</div>
</div>
</section>
<section class="slide" id="convention-over-configuration-3">
<h2>Convention over configuration</h2>
<div class="listingblock">
<div class="title">After build</div>
<div class="content">
<pre><code>basic-java/
├── build
│   ├── classes
│   │   ├── main
│   │   │   └── com
│   │   │       └── acme
│   │   │           └── Greeter.class
│   │   └── test
│   │       └── com
│   │           └── acme
│   │               └── GreeterTest.class
│   ├── libs
│   │   └── basic-java.jar
│   ├── reports
│   ├── test-results
│   └── tmp
├── build.gradle
└── src
    ...</code></pre>
</div>
</div>
</section>
<section class="slide" id="integration-tests">
<h2>Integration tests</h2>
<div class="paragraph"><p>What conventions exist for defining integration tests?</p></div>
<section class="slide" id="defining-a-new-source-set">
<h2>Defining a new source set</h2>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">sourceSets {
    integTest {
        groovy.srcDir file(<span class="string"><span class="delimiter">'</span><span class="content">src/integTest/groovy</span><span class="delimiter">'</span></span>)
        resources.srcDir file(<span class="string"><span class="delimiter">'</span><span class="content">src/integTest/resources</span><span class="delimiter">'</span></span>)
    }
}</code></pre>
</div>
</div>
</section>
<section class="slide" id="create-an-integtest-task">
<h2>Create an integTest task</h2>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">task integTest(<span class="key">type</span>:Test) {
    dependsOn jar
    mustRunAfter jar
    testClassesDir = sourceSets.integTest.output.classesDir
    classpath = sourceSets.integTest.runtimeClasspath
}
check.dependsOn(integTest)</code></pre>
</div>
</div>
</section>
<section class="slide" id="define-the-integration-test-classpath">
<h2>Define the integration test classpath</h2>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">configurations {
    integTestCompile
    integTestRuntime
}
dependencies {
    integTestCompile <span class="string"><span class="delimiter">'</span><span class="content">org.codehaus.groovy:groovy:2.4.3</span><span class="delimiter">'</span></span>
    integTestCompile(<span class="string"><span class="delimiter">'</span><span class="content">org.spockframework:spock-core:1.0-groovy-2.4</span><span class="delimiter">'</span></span>) {
        exclude <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">org.codehaus.groovy</span><span class="delimiter">'</span></span>
    }
    integTestCompile files(jar.archivePath)
}</code></pre>
</div>
</div>
</section>
</section>
<section class="slide" id="write-the-integration-test">
<h2>Write the integration test</h2>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="keyword">package</span> com.acme
<span class="keyword">import</span> <span class="include">spock.lang.Specification</span>

<span class="type">class</span> <span class="class">GreetingSpec</span> <span class="directive">extends</span> Specification {

   <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">should greet people</span><span class="delimiter">&quot;</span></span>() {
      <span class="key">given</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">a greeter instance</span><span class="delimiter">&quot;</span></span>
         <span class="keyword">def</span> greeter = <span class="keyword">new</span> Greeter()
      <span class="key">when</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">we greet someone</span><span class="delimiter">&quot;</span></span>
         <span class="keyword">def</span> greeting = greeter.greet(someone)
      <span class="key">then</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">greeting looks correct</span><span class="delimiter">&quot;</span></span>
         greeting == <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello, </span><span class="inline"><span class="inline-delimiter">$</span>someone</span><span class="content">!</span><span class="delimiter">&quot;</span></span>
      <span class="key">where</span>:
         someone &lt;&lt; [<span class="string"><span class="delimiter">'</span><span class="content">Bob</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">Alice</span><span class="delimiter">'</span></span>]
   }

}</code></pre>
</div>
</div>
<section class="slide" id="run-it">
<h2>Run it</h2>
<div class="listingblock">
<div class="content">
<pre><code>$ ./gradlew --daemon j-i:iT
:java-inttest:compileJava
:java-inttest:compileGroovy UP-TO-DATE
:java-inttest:processResources UP-TO-DATE
:java-inttest:classes
:java-inttest:jar
:java-inttest:compileIntegTestJava UP-TO-DATE
:java-inttest:compileIntegTestGroovy
:java-inttest:processIntegTestResources UP-TO-DATE
:java-inttest:integTestClasses
:java-inttest:integTest

BUILD SUCCESSFUL

Total time: 3.646 secs</code></pre>
</div>
</div>
</section>
</section>
<section class="slide" id="creating-a-source-jar">
<h2>Creating a source jar</h2>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">task sourcesJar(<span class="key">type</span>: Jar) {
    classifier = <span class="string"><span class="delimiter">'</span><span class="content">sources</span><span class="delimiter">'</span></span>
    from sourceSets.main.allSource
}</code></pre>
</div>
</div>
</section>
<section class="slide" id="what-about-other-source-trees">
<h2>What about other source trees?</h2>
<section class="slide" id="building-a-custom-convention">
<h2>Building a custom convention</h2>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">task sourcesJar()

sourceSets.each { sourceSet -&gt;
    Task t = task <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>sourceSet.name<span class="inline-delimiter">}</span></span><span class="content">SourcesJar</span><span class="delimiter">&quot;</span></span>(<span class="key">type</span>:Jar) {
        classifier = sourceSet.name==<span class="string"><span class="delimiter">'</span><span class="content">main</span><span class="delimiter">'</span></span>?<span class="string"><span class="delimiter">'</span><span class="content">sources</span><span class="delimiter">'</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>sourceSet.name<span class="inline-delimiter">}</span></span><span class="content">-sources</span><span class="delimiter">&quot;</span></span>
        from sourceSet.allSource
    }
    sourcesJar.dependsOn(t)
}</code></pre>
</div>
</div>
</section>
<section class="slide" id="output-directory">
<h2>Output directory</h2>
<div class="listingblock">
<div class="content">
<pre><code>examples/java-custom-artifacts/build/libs/
├── java-custom-artifacts-integTest-sources.jar
├── java-custom-artifacts-sources.jar
└── java-custom-artifacts-test-sources.jar</code></pre>
</div>
</div>
</section>
<section class="slide" id="can-we-make-it-cleaner">
<h2>Can we make it cleaner?</h2>
<div class="ulist">
<ul>
<li>How about sharing it with other sub-projects?</li>
<li>How about sharing it with external projects?</li>
</ul>
</div>
</section>
</section>
<section class="slide" id="writing-a-plugin">
<h2>Writing a plugin</h2>
<div class="ulist">
<ul>
<li>Usually written in Groovy</li>
<li>Can be written in Java</li>
<li>Other languages not recommended (adds dependencies)</li>
</ul>
</div>
<section class="slide" id="plugin-structure">
<h2>Plugin structure</h2>
<div class="imageblock">
<div class="content">
<img alt="plugin structure" src="./images/plugin-structure.png" />
</div>
</div>
</section>
</section>
<section class="slide" id="build-gradle">
<h2>build.gradle</h2>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">groovy</span><span class="delimiter">'</span></span>

group = <span class="string"><span class="delimiter">'</span><span class="content">com.acme.gradle</span><span class="delimiter">'</span></span>
version = <span class="string"><span class="delimiter">'</span><span class="content">1.0-SNAPSHOT</span><span class="delimiter">'</span></span>

repositories {
    jcenter()
}

dependencies {
    compile gradleApi()
    compile localGroovy()
    testCompile <span class="string"><span class="delimiter">'</span><span class="content">org.spockframework:spock-core:1.0-groovy-2.3</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</section>
<section class="slide" id="writing-a-plugin-2">
<h2>Writing a plugin</h2>
<section class="slide" id="plugin-class">
<h2>Plugin class</h2>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="type">class</span> <span class="class">SourcesJarPlugin</span> <span class="directive">implements</span> Plugin&lt;Project&gt; {
    <span class="annotation">@Override</span>
    <span class="type">void</span> apply(Project project) {
        <span class="comment">// do something</span>
    }
}</code></pre>
</div>
</div>
</section>
<section class="slide" id="descriptor">
<h2>Descriptor</h2>
<div class="listingblock">
<div class="title">src/main/resources/META-INF/gradle-plugins/com.acme.sourcesjar.properties</div>
<div class="content">
<pre class="CodeRay"><code>implementation-class=com.acme.SourcesJarPlugin</code></pre>
</div>
</div>
</section>
</section>
<section class="slide" id="plugin-code">
<h2>Plugin code</h2>
<div class="listingblock">
<div class="title">SourcesJarPlugin.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="type">class</span> <span class="class">SourcesJarPlugin</span> <span class="directive">implements</span> Plugin&lt;Project&gt; {
    <span class="annotation">@Override</span>
    <span class="type">void</span> apply(Project project) {
        project.afterEvaluate {
            <span class="keyword">def</span> sourcesJarTask = project.tasks.create(<span class="string"><span class="delimiter">'</span><span class="content">sourcesJar</span><span class="delimiter">'</span></span>)
            project.sourceSets.each { sourceSet -&gt;
                Task t = project.tasks.create(<span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>sourceSet.name<span class="inline-delimiter">}</span></span><span class="content">SourcesJar</span><span class="delimiter">&quot;</span></span>, <span class="key">type</span>: Jar) {
                    classifier = sourceSet.name == <span class="string"><span class="delimiter">'</span><span class="content">main</span><span class="delimiter">'</span></span> ? <span class="string"><span class="delimiter">'</span><span class="content">sources</span><span class="delimiter">'</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>sourceSet.name<span class="inline-delimiter">}</span></span><span class="content">-sources</span><span class="delimiter">&quot;</span></span>
                    from sourceSet.allSource
                }
                sourcesJarTask.dependsOn(t)
                project.artifacts.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">archives</span><span class="delimiter">&quot;</span></span>, t)
            }
        }
    }
}</code></pre>
</div>
</div>
</section>
<section class="slide" id="test-the-plugin">
<h2>Test the plugin</h2>
<div class="listingblock">
<div class="title">SourcesJarPluginTest.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">tasks are created when plugin is applied</span><span class="delimiter">&quot;</span></span>() {
     <span class="key">given</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">A sample project</span><span class="delimiter">&quot;</span></span>
     Project project = ProjectBuilder.builder()
             .withProjectDir(projectDir).build()

     <span class="key">when</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">We apply the sourcesjar plugin</span><span class="delimiter">&quot;</span></span>
     project.apply(<span class="key">plugin</span>:<span class="string"><span class="delimiter">'</span><span class="content">com.acme.sourcesjar</span><span class="delimiter">'</span></span>)

     <span class="key">then</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">the sourcesJar task is created</span><span class="delimiter">&quot;</span></span>
     project.getTasksByName(<span class="string"><span class="delimiter">'</span><span class="content">sourcesJar</span><span class="delimiter">'</span></span>, <span class="predefined-constant">false</span>).size() == <span class="integer">1</span>
 }</code></pre>
</div>
</div>
</section>
<section class="slide" id="publishing-the-plugin">
<h2>Publishing the plugin</h2>
<section class="slide" id="the-maven-publish-plugin">
<h2>The maven-publish plugin</h2>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">maven-publish</span><span class="delimiter">'</span></span>

publishing {
    publications {
        mavenJava(MavenPublication) {
            from components.java
        }
    }
}</code></pre>
</div>
</div>
</section>
<section class="slide" id="publish-to-local-repo">
<h2>Publish to local repo</h2>
<div class="listingblock">
<div class="content">
<pre><code>$ ./gradlew --daemon publishToMavenLocal
:plugin-custom-artifacts:generatePomFileForMavenJavaPublication
:plugin-custom-artifacts:compileJava UP-TO-DATE
:plugin-custom-artifacts:compileGroovy
:plugin-custom-artifacts:processResources
:plugin-custom-artifacts:classes
:plugin-custom-artifacts:jar
:plugin-custom-artifacts:publishMavenJavaPublicationToMavenLocal
:plugin-custom-artifacts:publishToMavenLocal

BUILD SUCCESSFUL

Total time: 2.011 secs</code></pre>
</div>
</div>
</section>
</section>
<section class="slide" id="use-the-plugin">
<h2>Use the plugin</h2>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">buildscript {
    repositories {
        mavenLocal()
    }
    dependencies {
        classpath <span class="string"><span class="delimiter">'</span><span class="content">com.acme.gradle:plugin-custom-artifacts:1.0-SNAPSHOT</span><span class="delimiter">'</span></span>
    }
}

apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">com.acme.sourcesjar</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<section class="slide" id="output">
<h2>Output</h2>
<div class="listingblock">
<div class="content">
<pre><code>$ ./gradlew sourcesJar
:java-custom-artifacts:integTestSourcesJar UP-TO-DATE
:java-custom-artifacts:mainSourcesJar UP-TO-DATE
:java-custom-artifacts:testSourcesJar UP-TO-DATE
:java-custom-artifacts:sourcesJar UP-TO-DATE
:java-custom-artifacts-using-plugin:integTestSourcesJar
:java-custom-artifacts-using-plugin:mainSourcesJar
:java-custom-artifacts-using-plugin:testSourcesJar
:java-custom-artifacts-using-plugin:sourcesJar
:java-inttest-sourcesjar:sourcesJar UP-TO-DATE

BUILD SUCCESSFUL

Total time: 0.704 secs</code></pre>
</div>
</div>
</section>
</section>
<section class="slide" id="conventions-evolved">
<h2>Conventions evolved</h2>
<div class="ulist">
<ul>
<li>the <strong>model</strong> is important</li>
<li>plugins can reason on the model rather than outputs</li>
</ul>
</div>
<section class="slide" id="generating-a-checksum-for-all-artifacts">
<h2>Generating a checksum for all artifacts</h2>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="keyword">import</span> <span class="include">org.gradle.api.DefaultTask</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.TaskAction</span>

<span class="type">class</span> <span class="class">Checksum</span> <span class="directive">extends</span> DefaultTask {
    <span class="predefined-type">Checksum</span>() {
        project.afterEvaluate {
            project.configurations.each {
                <span class="local-variable">it</span>.artifacts.each { artifact -&gt;
                    <span class="local-variable">this</span>.dependsOn(artifact.buildDependencies)
                }
            }
        }
    }

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> exec() {
        project.configurations.each {
            <span class="local-variable">it</span>.artifacts.files.each { f -&gt;
                project.ant.checksum(<span class="key">file</span>:f)
            }
        }
    }
}</code></pre>
</div>
</div>
</section>
<section class="slide" id="using-the-task">
<h2>Using the task</h2>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">allprojects {
    task checksum(<span class="key">type</span>: <span class="predefined-type">Checksum</span>)
}</code></pre>
</div>
</div>
</section>
</section>
<section class="slide" id="improving-it">
<h2>Improving it</h2>
<div class="ulist">
<ul>
<li>Each task can define its inputs/outputs</li>
<li>You should <strong>always</strong> do it</li>
</ul>
</div>
<section class="slide" id="improved-checksum">
<h2>Improved checksum</h2>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">project.afterEvaluate {
    project.configurations.each {
        <span class="local-variable">it</span>.artifacts.each { artifact -&gt;
            <span class="local-variable">this</span>.dependsOn(artifact.buildDependencies)
        }
        <span class="local-variable">it</span>.artifacts.files.each { f -&gt;
            inputs.file(f)
            outputs.file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>f<span class="inline-delimiter">}</span></span><span class="content">.MD5</span><span class="delimiter">&quot;</span></span>)
        }
    }
}</code></pre>
</div>
</div>
</section>
</section>
<section class="slide" id="convention-over-configuraton-versioning">
<h2>Convention over configuraton : versioning</h2>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">configurations.all {
    resolutionStrategy.eachDependency { DependencyResolveDetails details -&gt;
        <span class="keyword">if</span> (details.requested.version == <span class="string"><span class="delimiter">'</span><span class="content">default</span><span class="delimiter">'</span></span>) {
            <span class="keyword">def</span> version = findDefaultVersionInCatalog(details.requested.group, details.requested.name)
            details.useVersion version
        }
    }
}</code></pre>
</div>
</div>
</section>
<section class="slide" id="a-glance-at-the-future">
<h2>A glance at the future</h2>
<section class="slide" id="android-build-plugin">
<h2>Android build plugin</h2>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">com.android.application</span><span class="delimiter">'</span></span>

android {
    compileSdkVersion <span class="integer">20</span>
    buildToolsVersion <span class="string"><span class="delimiter">&quot;</span><span class="content">20.0.0</span><span class="delimiter">&quot;</span></span>

    defaultConfig {
        applicationId <span class="string"><span class="delimiter">&quot;</span><span class="content">com.mycompany.myapplication</span><span class="delimiter">&quot;</span></span>
        minSdkVersion <span class="integer">13</span>
        targetSdkVersion <span class="integer">20</span>
        versionCode <span class="integer">1</span>
        versionName <span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span>
    }

    buildTypes {
        release {
            minifyEnabled <span class="predefined-constant">false</span>
            proguardFiles getDefaultProguardFile(<span class="string"><span class="delimiter">'</span><span class="content">proguard-android.txt</span><span class="delimiter">'</span></span>), <span class="string"><span class="delimiter">'</span><span class="content">proguard-rules.pro</span><span class="delimiter">'</span></span>
        }
         debug {
            debuggable <span class="predefined-constant">true</span>
        }
    }
}

dependencies {
    compile fileTree(<span class="key">dir</span>: <span class="string"><span class="delimiter">'</span><span class="content">libs</span><span class="delimiter">'</span></span>, <span class="key">include</span>: [<span class="string"><span class="delimiter">'</span><span class="content">*.jar</span><span class="delimiter">'</span></span>])
    compile <span class="string"><span class="delimiter">'</span><span class="content">com.android.support:appcompat-v7:20.0.0</span><span class="delimiter">'</span></span>
    compile project(<span class="key">path</span>: <span class="string"><span class="delimiter">'</span><span class="content">:app2, configuration: </span><span class="delimiter">'</span></span>android-endpoints<span class="string"><span class="delimiter">'</span><span class="content">)</span></span><span class="error">
</span>}</code></pre>
</div>
</div>
</section>
</section>
<section class="slide" id="defining-your-own-model">
<h2>Defining your own model</h2>
<div class="ulist">
<ul>
<li>A new model API is in the works</li>
<li>Allows definining custom models</li>
<li>Models can be shared between plugins</li>
<li>Allows faster build execution as well as parallel task execution</li>
</ul>
</div>
<section class="slide" id="example">
<h2>Example</h2>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="annotation">@Managed</span>
<span class="type">interface</span> Person {
  <span class="type">void</span> setFirstName(<span class="predefined-type">String</span> n); <span class="predefined-type">String</span> getFirstName()
  <span class="type">void</span> setLastName(<span class="predefined-type">String</span> n); <span class="predefined-type">String</span> getLastName()
}

<span class="type">class</span> <span class="class">PersonRules</span> <span class="directive">extends</span> RuleSource {
  <span class="annotation">@Model</span> <span class="type">void</span> person(Person p) {}

  <span class="annotation">@Mutate</span> <span class="type">void</span> setFirstName(Person p) {
    p.firstName = <span class="string"><span class="delimiter">&quot;</span><span class="content">John</span><span class="delimiter">&quot;</span></span>
  }

 <span class="annotation">@Mutate</span> <span class="type">void</span> createHelloTask(CollectionBuilder&lt;Task&gt; tasks, Person p) {
    tasks.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>) {
      doLast {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello </span><span class="inline"><span class="inline-delimiter">$</span>p</span><span class="content">.firstName </span><span class="inline"><span class="inline-delimiter">$</span>p</span><span class="content">.lastName!</span><span class="delimiter">&quot;</span></span>
      }
    }
  }
}

apply <span class="key">plugin</span>: PersonRules</code></pre>
</div>
</div>
</section>
</section>
<section class="slide" id="questions">
<h2>Questions</h2>
<div class="imageblock">
<div class="content">
<img alt="qa" src="./images/qa.png" />
</div>
</div>
</section>
<section class="slide" id="thank-you">
<h2>Thank you!</h2>
<div class="ulist">
<ul>
<li>Slides and code : <a class="bare" href="https://github.com/melix/bdxjug2015">https://github.com/melix/bdxjug2015</a></li>
<li>Gradle documentation : <a class="bare" href="http://gradle.org/docs/current/userguide/userguide">http://gradle.org/docs/current/userguide/userguide</a></li>
<li>Follow me: <a href="http://twitter.com/CedricChampeau">@CedricChampeau</a></li>
</ul>
</div>
</section>
<div aria-role="navigation">
<a class="deck-prev-link" href="#" title="Previous">&#8592;</a>
<a class="deck-next-link" href="#" title="Next">&#8594;</a>
</div>
<p aria-role="status" class="deck-status">
<span class="deck-status-current"></span>
/
<span class="deck-status-total"></span>
</p>
<form action="." class="goto-form" method="get">
<label for="goto-slide">Go to Slide:</label>
<input id="goto-slide" list="goto-datalist" name="slidenum" type="text" />
<datalist id="goto-data-list"></datalist>
<input type="submit" value="Go" />
</form>
</div>
<script src="deck.js/jquery.min.js"></script>
<script src="deck.js/core/deck.core.js"></script>
<script src="deck.js/extensions/scale/deck.scale.js"></script>
<script src="deck.js/extensions/goto/deck.goto.js"></script>
<script src="deck.js/extensions/menu/deck.menu.js"></script>
<script src="deck.js/extensions/navigation/deck.navigation.js"></script>
<script src="deck.js/extensions/status/deck.status.js"></script>
<script src="deck.js/extensions/toc/deck.toc.js"></script>
<div class="deck-toc"></div>
<script type="text/javascript">
  //<![CDATA[
    (function($, deck, undefined) {
      $.deck.defaults.keys['previous'] = [8, 33, 37, 39];
      $.deck.defaults.keys['next'] = [13, 32, 34, 39];
    
      $.extend(true, $[deck].defaults, {
          countNested: false
      });
    
      $.deck('.slide');
    })(jQuery, 'deck');
  //]]>
</script>
<style type="text/css">
  /*<![CDATA[*/
    .slide.canvas-image {
    -moz-background-size: cover;
    -webkit-background-size: cover;
    -o-background-size: cover;
    background-size: cover;
    display: -moz-box;
    display: -webkit-box;
    display: -ms-box;
    display: box;
    -moz-box-orient: vertical;
    -webkit-box-orient: vertical;
    -ms-box-orient: vertical;
    box-orient: vertical;
    -moz-box-align: start;
    -webkit-box-align: start;
    -ms-box-align: start;
    box-align: start;
    -moz-box-pack: start;
    -webkit-box-pack: start;
    -ms-box-pack: start;
    box-pack: start;}
    
    .bottom-left {
      left: 1%;
      bottom: 20%; }
    
    .top-left {
      left: 1%;
      top: 20%; }
    
    .bottom-right {
      right: 1%;
      bottom: 20%; }
    
    .top-right {
      right: 1%;
      top: 20%; }
    
    .center-up {
      right: 50%;
      top: 1%;
    }
    
    .center-down {
      right: 50%;
      bottom: 1%;
    }
    .canvas-image .canvas-caption p {
      text-align: center;
      padding-top: 0;
      padding: 0;
      -moz-transform: none;
      -webkit-transform: none;
      -o-transform: none;
      -ms-transform: none;
      transform: none;
      display: inline;
      position: absolute;
      background-color: rgba(0, 0, 0, 0.7);
      font-weight: bold;
      font-size: 58px;
      -webkit-box-shadow: 2px 2px 2px #000;
      -moz-box-shadow: 2px 2px 2px #000;
      box-shadow: 2px 2px 2px #000;
      padding: 1rem;
      color: white; }
    kbd.keyseq { color: #555555; }
    kbd:not(.keyseq) {
      display: inline-block;
      color: #222222;
      font-size: 0.7em;
      line-height: 1.4;
      background-color: #F7F7F7;
      border: 1px solid #ccc;
      -webkit-border-radius: 3px;
      border-radius: 3px;
      -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset;
      box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset;
      margin: -0.15em 0.15em 0 0.15em;
      padding: 0.2em 0.6em;
      vertical-align: middle;
      white-space: nowrap;
    }
    kbd kbd:first-child { margin-left: 0; }
    kbd kbd:last-child { margin-right: 0; }
  /*]]>*/
</style>
</body>
</html>